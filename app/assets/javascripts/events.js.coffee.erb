# Place all the behaviors and hooks related to the matching controller here.
# All this logic will automatically be available in application.js.
# You can use CoffeeScript in this file: http://jashkenas.github.com/coffee-script/

# Best in place functions
$ ->
  $('.best_in_place').best_in_place()

$ ->
  $('.best_in_place').bind "ajax:success", (event, data) ->
   $.ajax $(this).data(window.location.pathname),
    type: 'GET'
    dataType: 'html'
    error: (jqXHR, textStatus, errorThrown) ->
        console.log "AJAX Error: #{textStatus}"
    success: (data, textStatus, jqXHR) =>
      target = $(this).data('attribute')
      content = $(data).find(".#{target}").html()
      $(".#{target}").html content
      if target is 'address' then $(".location-city").html $(data).find(".location-city").html()
      orderTotal()
      $('#order_quantity').on "change", orderTotal
# Sum Order
$ ->
  orderTotal()
  $('#order_quantity').on "change", orderTotal


# Order Total method
orderTotal = (quantity, price) ->
  quantity = $('#order_quantity').val()
  price = $('.price').data('original-content')
  net_price = quantity * price
  gross = (net_price / .961) + 0.30
  order_price = if price > 0 then gross else 0.0
  $('.order-total').html(order_price.toFixed(2))
  # $('.stripe-button').attr('data-amount', number * 100)

# Filter form for index page
$ ->
  $('#event_city').change ->
    $(this).closest('form').trigger('submit')

# Jquery Ui Datepicker
$ ->
  $("input.datepicker").datepicker()

  $.datepicker.setDefaults
    dateFormat: 'MM dd, yy'

#  slimScroll for about piece in event show
$ ->
  $(".about-event").slimScroll height: '250px'

# backSretch
$ ->
  if $("#event-information").length
    $(".event-header").backstretch($(".event-poster").data('url'))

# Disable stripe-button if email field is blank
$ ->
  if $("#order_email").val() is ""
    $(".stripe-button-el").attr "disabled", true
    $('.warning-pop').popover()
      # trigger: 'hover'
  $("#order_email").keyup ->
    unless $("#customer-email").val() is ""
      $(".stripe-button-el").attr "disabled", false
      $(".warning-pop").popover('disable').popover("hide");
    else
      $(".stripe-button-el").attr "disabled", true

# Charges popover
$ ->
  $('.charge-info').popover
      trigger: 'hover'

$ ->
  $('.icon-question-sign').popover
      trigger: 'hover'

$ ->
  width = $('.bar').data('funded')
  $('.bar').css("width", "#{width}%")

# Equal height for payment and info boxes
$ ->
  boxes = $(".well")
  maxHeight = Math.max.apply(Math, boxes.map(->
    $(this).height()
  ).get())
  boxes.height maxHeight


(($) ->
  $.fn.uniformHeight = ->
    maxHeight = 0
    max = Math.max
    @each(->
      maxHeight = max(maxHeight, $(this).height())
    ).height maxHeight
) jQuery

$(window).load ->
  $("ul.thumbnails").find("a.thumbnail").uniformHeight()