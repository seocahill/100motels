# Place all the behaviors and hooks related to the matching controller here.
# All this logic will automatically be available in application.js.
# You can use CoffeeScript in this file: http://jashkenas.github.com/coffee-script/

# Order Total method
@orderTotal = () ->
  quantity = $('#order_quantity').val()
  price = $('.price').data('price')
  net_price = quantity * price
  gross = (net_price / .961) + 0.30
  order_price = if price > 0 then gross else 0.0
  $('.order-total').html(order_price.toFixed(2))

# Best in place stuff
$ ->
  $('.best_in_place_about').on 'ajax:success', () ->
    $.get window.location.pathname, (data) ->
      $('.about').html $(data).find(".about").html()
      # $('.edit-about').text "Edit"
      # $('#cancel-button').removeClass("hideme")

$ ->
  $('.edit-about').click () ->
    $(this).text () ->
      if $(this).is('.active') then "Edit" else "Save"
    $('#cancel-button').toggleClass("hideme")

$ ->
  $('#cancel-button').on 'mousedown', () ->
    $('.edit-about').removeClass('active').text("Edit")
    $(this).addClass("hideme")

$ ->
  $(document).keyup (e) ->
    if e.keyCode is 27 and $('.edit-about').is('.active')
      $('.edit-about').removeClass('active').text("Edit")
      $('#cancel-button').addClass("hideme")

$ ->
  $('.best_in_place').best_in_place()

# Sum Order
$ ->
  orderTotal()
  $('#order_quantity').change ->
    orderTotal()

# backSretch
$ ->
  $("#event-banner").backstretch($("#event-banner").data('url'))

# Progress bar
$ ->
  widthSold = $('.progress-bar').data('funded')
  widthUnsold = 100 - $('.progress-bar').data('funded')

  $('.sold').css("width", "#{widthSold}%")
  $('.unsold').css("width", "#{widthUnsold}%")

$ ->
  $("#checkout").click ->
    token = (res) ->
      $input = $("<input type=hidden name=stripeToken />").val(res.id)
      $("form").append($input).submit()
    StripeCheckout.open
      key: "<%= ENV['STRIPE_PUBLIC_KEY'] %>"
      address: false
      amount: Number($('.order-total').text()) * 100
      currency: "usd"
      name: "100 Motels"
      description: "Your Tickets"
      panelLabel: "Checkout"
      token: token
    return false
